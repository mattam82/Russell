\begin{lemma}[Transitivité de la coercion avec affaiblissement]
  \label{coerce-trans-weak}
  S'il existe $c_1, c_2$ tels que $\subimpl{`G}{c_1}{S}{T}$ et
  $\subimpl{`D}{c_2}{T}{U}$ 
  avec $`r : `D \sub `G$ et $\ip{T}{`G}[`r] `= \ip{T}{`D}$,
  alors $`E!c, \subimpl{`D}{c}{S}{U}$ et $c `= c_2 `o c_1[`r]$.
\end{lemma}
\begin{proof}
  Par induction lexicographique sur la paire de dérivations de $c_1$ et $c_2$.

  \begin{induction}
       
    \case{SubConv} On va traiter les cas où cette règle est utilisée en
    racine d'une des deux dérivations, d'abord à gauche puis à droite.

    \begin{prooftree}
      \AXC{$S \eqbr T$}
      \UIC{$\subimpl{`G}{c_1 = \ctxdot}{S}{T}$}
      \AXC{$\subimpl{`D}{c_2}{T}{U}$}
      \noLine\BIC{}
    \end{prooftree}
    
    Les conditions de bord de \irule{SubConv} nous donnent comme
    hypothèses que $S$ et $T$ sont en forme normale de tête et que 
    $S "/=" \Pi, \Sigma, \{|\}$. Par inversion de la
    $\beta\rho$-équivalence $S \eqbr T$, on a aussi $T "/=" \Pi, \Sigma, \{|\}$.
    Les seules règles pouvant s'appliquer a la fin de la dérivation de
    $c_2$ sont donc \irule{SubConv}, \irule{SubHnf} et \irule{SubProof}.

    \begin{induction}
      \case{SubConv} Alors on a $U = \hnf{U} "/=" \Pi, \Sigma, \{|\}$.
      La coercion composée est alors $\ctxdot `o \ctxdot$. C'est bien la coercion
      dérivée pour le jugement $\subimpl{`D}{\ctxdot}{S}{U}$ par \irule{SubConv}.
      
      \case{SubHnf} On a alors $\subimpl{`D}{c_2}{\hnf{T}}{\hnf{U}}$.
      Comme $T = \hnf{T}$, on peut appliquer l'hypothèse d'induction pour
      obtenir une coercion $c$ telle que $\subimpl{`D}{c}{S}{\hnf{U}}$ et
      $c `= c_2 `o c_1[`r]$.
      Une application de \irule{SubHnf} suffit pour obtenir une
      dérivation de $\subimpl{`D}{c}{S}{U}$ avec $c `= c_2 `o c_1[`r]$.
      
      \case{SubProof} Ici on a:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{d}{T}{U'}$}
        \UIC{$\subimpl{`D}{c_2 = {\elt{\ip{U'}{`D}}{\ip{\lambda x : U'.P}{`D}}{d}
              {\ex{\ip{P}{`D}[d/x]}}}}{T}{U = \mysubset{x}{U'}{P}}$}
      \end{prooftree}

      Par induction, il existe une coercion $d' `= d `o c_1[`r] = d$ telle que
      $\subimpl{`D}{d'}{S}{U'}$. On applique \irule{SubProof} pour obtenir
      la coercion $c$ de $S$ à $U$. Clairement $c `= c_2 `o c_1[`r] =
      c_2 `o \ctxdot = c_2$.
      
    \end{induction}
    
    Supposons maintenant que la dérivation de $c_2$ termine par une
    application de \irule{SubConv}. Alors $T$ et $U$ sont en forme
    normale de tête et $T, U "/=" \Pi, \Sigma, \{|\}$.
    Les seules règles pouvant apparaître en racine de la dérivation de
    $c_1$ sont donc \irule{SubConv}, \irule{SubHnf} et \irule{SubSub}.

    \begin{induction}
      \case{SubConv} Alors on a $S = \hnf{S} "/=" \Pi, \Sigma, \{|\}$.
      La coercion composée est alors $\ctxdot `o \ctxdot$. C'est bien la coercion
      dérivée pour le jugement $\subimpl{`D}{\ctxdot}{S}{U}$ par \irule{SubConv}.
      
      \case{SubHnf} On a alors $\subimpl{`G}{c_1}{\hnf{S}}{\hnf{T}}$.
      Comme $T = \hnf{T}$, on peut appliquer l'hypothèse d'induction pour
      obtenir une coercion $c$ telle que $\subimpl{`D}{c}{\hnf{S}}{U}$ et
      $c `= c_2 `o c_1[`r]$.
      Une application de \irule{SubHnf} suffit pour obtenir une
      dérivation de $\subimpl{`D}{c}{S}{U}$ avec $c `= c_2 `o c_1[`r]$.
      
      \case{SubSub} Ici on a:
      \begin{prooftree}
        \AXC{$\subimpl{`G}{d}{S'}{T}$}
        \UIC{$\subimpl{`G}{c_1 = d[\eltpit~\ctxdot]}{S = \mysubset{x}{S'}{P}}{T}$}
      \end{prooftree}

      Par induction, il existe une coercion $d' `= c_2 `o d[`r] = d[`r]$ telle que
      $\subimpl{`D}{d'}{S'}{U}$. On applique \irule{SubSub} pour obtenir
      la coercion $c = d[`r][\eltpit~\ctxdot]$ de $S$ à $U$. On a \[c =
      d[`r][\eltpit~\ctxdot] = d[\eltpit~\ctxdot][`r] `= c_2 `o c_1[`r] \]

    \end{induction}

    \case{SubHnf}\quad
    \begin{prooftree}
      \AXC{$\subimpl{`G}{c}{\hnf{S}}{\hnf{T}}$}
      \UIC{$\subimpl{`G}{c}{S}{T}$}
      \AXC{$\subimpl{`D}{d}{T}{U}$}
      \noLine\BIC{} % $\subimpl{`G}{d `o c}{S}{U}$
    \end{prooftree}
    
    Si $T = \hnf{T}$ alors c'est trivial par induction et application de
    \irule{SubHnf}.
    Sinon, la seule règle permettant de dériver $\subimpl{`D}{d}{T}{U}$
    est \irule{SubHnf}. Il suffit alors d'appliquer l'hypothèse
    d'induction pour obtenir une dérivation de
    $\subimpl{`D}{c}{\hnf{S}}{\hnf{U}}$ avec $c `= c_2 `o c_1[`r]$ puis
    \irule{SubHnf} nous permet de construire le jugement
    $\subimpl{`G}{c}{S}{U}$. 

    De même si l'on a une application de \irule{SubHnf} à la racine de
    la dérivation de droite.
    
    On peut donc se ramener au cas où \irule{SubConv} et
    \irule{SubHnf} ne sont appliquées à la racine d'aucune des 
    deux dérivations.

    
    \case{SubProd}\quad
    \begin{prooftree}
      \AXC{$\subimpl{`G}{c_1}{X'}{X}$}
      \AXC{$\subimpl{`G, x : X'}{c_2}{Y}{Y'}$}
      \BIC{$\subimpl{`G}{c = \lambda x : \ip{X'}{`G}.c_2[\ctxdot~c_1[x]]}{\Pi x : X.Y}{\Pi x : X'.Y'}$}
      \AXC{$\subimpl{`D}{d}{\Pi x : X'.Y'}{U}$}
      \noLine\BIC{}
    \end{prooftree}
    
    Par induction sur la dérivation $\subimpl{`D}{d}{\Pi x :
      X'.Y'}{U}$. Seules deux règles peuvent s'appliquer à la racine:
    \begin{induction}
      \case{SubProd} On a $U = \Pi x : S.T$ et la dérivation a la forme:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{d_1}{S}{X'}$}
        \AXC{$\subimpl{`D, x : S}{d_2}{Y'}{T}$}
        \BIC{$\subimpl{`D}{d = (\lambda x : \ip{S}{`D}.d_2[\ctxdot~d_1[x]])}
          {\Pi x : X'.Y'}{\Pi x : S.T}$}
      \end{prooftree}

      On peut construire une coercion de contextes de $`q = `r, d_1 : (`D, x : S) \sub (`G, x : X')$. 
      Par le lemme \ref{coerce-narrowing-coercion} on obtient la dérivation
      $\subimpl{`D, x : S}{c_2'}{Y}{Y'}$ de même
      taille que la dérivation de $c_2$ telle que $c_2' `= c_2[`q]$.      
      On obtient de même $\subimpl{`D}{c_1'}{X'}{X}$ avec $c_1' `= c_1[`r]$.

      En utilisant une coercion de contextes partout l'identité, on
      obtient par induction avec les dérivations de $c_1'$ et $d_1$
      d'une part et $c_2'$ et $d_2$ d'autre part, deux coercions
      $e_1, e_2$ telles que:
      \[\subimpl{`D}{e_1 `= c_1[`r] `o d_1}{S}{X} `^
      \subimpl{`D, x : S}{e_2 `= d_2 `o c_2[`r]}{Y}{T}\]
      
      On en déduit:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{e_1}{S}{X}$}
        \AXC{$\subimpl{`D, x : S}{e_2}{Y}{T}$}
        \BIC{$\subimpl{`D}{e = \lambda x : \ip{S}{`D}.e_2[\ctxdot~e_1[x]]}
          {\Pi x : X.Y}{\Pi x : S.T}$}
      \end{prooftree}

      On a bien $e `= d `o c[`r]$:
      \begin{equations}
        \firsteq{d `o c[`r]}

        \step{Définition de $c$ et $d$}
        {\eqdef}{(\lambda x : \ip{S}{`D}.d_2[\ctxdot~d_1[x]]) `o (\lambda
          y : \ip{X'}{`G}.c_2[\ctxdot~c_1[y]])[`r]}
        
        \step{Composition des contextes}
        {=}{\lambda x : \ip{S}{`D}.d_2[(\lambda y :
          \ip{X'}{`G}.c_2[\ctxdot~c_1[y]])[`r]~d_1[x]]}

        \step{Substitution dans l'abstraction}
        {=}{\lambda x : \ip{S}{`D}.d_2[(\lambda y :
          \ip{X'}{`G}[`r].c_2[\ctxdot~c_1[y]][`r])~d_1[x]]}
        
        \step{Réduction}
        {"->"_{\beta}}
        {\lambda x :
          \ip{S}{`D}.d_2[(c_2[\ctxdot~c_1[y]][`r])[d_1[x]/y]]}
        
        \step{$y `; `r$}
        {=}
        {\lambda x :
          \ip{S}{`D}.d_2[(c_2[`r][\ctxdot~c_1[`r][y]])[d_1[x]/y]]}
        
        \step{Définition de $`q$, $y `; d1[x]$}
        {\eqdef}{\lambda x : \ip{S}{`D}.d_2[c_2[`q][\ctxdot~c_1[`q][d_1[x]]]]}

        \step{$d_2 `o c_2[`q] `= e_2$}
        {`=}{\lambda x : \ip{S}{`D}.e_2[\ctxdot~c_1[`q][d_1[x]]]}

        \step{$x `; c_1 "=>" c_1[`q] = c_1[`r]$}
        {`=}{\lambda x : \ip{S}{`D}.e_2[\ctxdot~e_1[x]]}
        
        \step{Définition}
        {\eqdef}{e}
      \end{equations}      
      
      \case{SubProof}
      Ici $U = \mysubset{y}{U'}{P}$ et la dérivation commence
      par:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{e}{\Pi x : X'.Y'}{U'}$}
        \UIC{$\subimpl{`D}{d = \elt{\ip{U'}{`D}}
            {\ip{\lambda x : U'.P}{`D}}{e}
            {\ex{\ip{P}{`D}[e/x]}}}
          {\Pi x : X'.Y'}{\mysubset{y}{U'}{P}}$}
      \end{prooftree}

      Par induction on a $\subimpl{`D}{f `= e `o c[`r]}{\Pi x : X.Y}{U'}$.
      On peut donc dériver:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{f}{\Pi x : X.Y}{U'}$}
        \UIC{$\subimpl{`D}{d' = \elt{\ip{U'}{`D}}
            {\ip{\lambda x : U'.P}{`D}}{f}
            {\ex{\ip{P}{`D}[f/x]}}}
          {\Pi x : X.Y}{U}$}
      \end{prooftree}
      
      On peut vérifier que $d' `= d `o c[`r]$:
      \begin{eqnarray*}
        d `o c[`r] & \eqdef & (\elt{\ip{U'}{`D}}
        {\ip{\lambda x : U'.P}{`D}}{e}
        {\ex{\ip{P}{`D}[e/x]}})[c[`r]] \\
        & = & \elt{\ip{U'}{`D}}
        {\ip{\lambda x : U'.P}{`D}}{e[c[`r]]}
        {\ex{\ip{P}{`D}[e[c[`r]]/x]}} \\
        & `= & \elt{\ip{U'}{`D}}
        {\ip{\lambda x : U'.P}{`D}}{f}
        {\ex{\ip{P}{`D}[f/x]}} \\
        & \eqdef & d'
      \end{eqnarray*}
      
    \end{induction}
    
    \case{SubSigma} De façon équivalente à \irule{SubProd}, on fait le cas où
    \irule{SubSigma} est utilisée à la fin de la dérivation de $d$.
    \begin{prooftree}
      \AXC{$\subimpl{`G}{c}{T}{\Sigma x : X'.Y'}$}
      \AXC{$\subimpl{`D}{d_1}{X'}{X}$}
      \AXC{$\subimpl{`D, x : X'}{d_2}{Y'}{Y}$}
      \BIC{$\subimpl{`D}
        {d = \pair{\ip{\Sigma x :
              X.Y}{`D}}{d_1[\pi_1~\ctxdot]}{d_2[\pi_2~\ctxdot][{\pi_1~\ctxdot}/x]}}
        {\Sigma x : X'.Y'}{\Sigma x : X.Y}$}
      \noLine\BIC{}
    \end{prooftree}

    Par induction sur la dérivation de $\subimpl{`G}{c}{T}{\Sigma x
      : X'.Y'}$:
    \begin{induction}
      \case{SubSub}
      On a: 
      \begin{prooftree}
        \AXC{$\subimpl{`G}{c_1}{T}{\Sigma x : X'.Y'}$}
        \UIC{$\subimpl{`G}{c = c_1[\eltpit~\ctxdot]}{\mysubset{y}{T}{P}}{\Sigma x : X'.Y'}$}
      \end{prooftree}
      
      Par induction, $\subimpl{`D}{f `= d `o c_1[`r]}{T}{\Sigma x :
        X.Y}$, on a donc:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{f `= d `o c_1[`r]}{T}{\Sigma x : X.Y}$}
        \UIC{$\subimpl{`D}{c' = f[\eltpit~\ctxdot]}{\mysubset{y}{T}{P}}{\Sigma x : X.Y}$}
      \end{prooftree}
      
      On a bien:
      \begin{eqnarray*}
        d `o c[`r] & `= & d `o c_1[\eltpit~\ctxdot][`r] \\
        & = & d `o c_1[`r][\eltpit~\ctxdot] \\
        & `= & f[\eltpit~\ctxdot] \\
        & \eqdef & c'
      \end{eqnarray*}
      
      \case{SubSigma}
      On a:
      \begin{prooftree}
        \AXC{$\subimpl{`G}{c_1}{S}{X'}$}
        \AXC{$\subimpl{`G, x : S}{c_2}{T}{Y'}$}
        \BIC{$\subimpl{`G}{c = \pair{\ip{\Sigma x : X'.Y'}{`G}}
            {c_1[\pi_1~\ctxdot]}
            {c_2[\pi_1~\ctxdot/x][\pi_2~\ctxdot]}}
            {\Sigma x : S.T}{\Sigma x : X'.Y'}$}
      \end{prooftree}
      
      Par affaiblissement pour les coercions (lemme
      \ref{coerce-narrowing-coercion}) on a $\subimpl{`D}{c_1'}{S}{X'}$ avec $c_1' `= c_1[`r]$.
      On peut aussi construire la coercion de contexte
      $`q = `r, \ctxdot : (`D, x : S) \sub (`G, x : S)$. Par le même lemme on obtient
      $\subimpl{`D, x : S}{c_2'}{T}{Y'}$ avec $c_2' `= c_2[`q] =
      c_2[`r]$. On peut enfin construire le jugement
      $\subimpl{`D, x : S}{d_2'}{Y'}{Y}$ avec $d_2' `= d_2[c_1'[x]/x]$.
      
      Par induction en utilisant une coercion de contexte partout
      l'identité on a donc:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{e_1 `= d_1 `o c_1[`r]}{S}{X}$}
        \AXC{$\subimpl{`D, x : S}{e_2 `= d_2' `o c_2'}{T}{Y}$}
        \BIC{$\subimpl{`D}{e = \pair{\ip{\Sigma x : X.Y}{`D}}
            {e_1[\pi_1~\ctxdot]}
            {e_2[\pi_1~\ctxdot/x][\pi_2~\ctxdot]}}
          {\Sigma x : S.T}{\Sigma x : X.Y}$}
      \end{prooftree}
      
      On peut vérifier:
      \begin{equations}
        \firsteq{d `o c[`r]}

        \step{Définition de $d$}
        {\eqdef}{\pair{\ip{\Sigma x :
              X.Y}{`D}}{d_1[\pi_1~\ctxdot]}{d_2[\pi_1~\ctxdot/x][\pi_2~\ctxdot]}[c[`r]]}
        
        \step{Substitution}
        {=}{
          \pair{\ip{\Sigma x : X.Y}{`D}}
          {d_1[\pi_1~c[`r]]}
          {d_2[\pi_1~c[`r]/x][\pi_2~c[`r]]}}
        
        \step{Réduction}
        {"->"_\pi}{
          \pair{\ip{\Sigma x : X.Y}{`D}}
          {d_1[c_1[`r][\pi_1~\ctxdot]]}
          {d_2[(c_1[\pi_1~\ctxdot])[`r]/x][c_2[`r][\pi_1~\ctxdot/x][\pi_2~\ctxdot]]}}

        \step{Définition de $e_1$}
        {`=}
        {\pair{\ip{\Sigma x : X.Y}{`D}}
          {e_1[\pi_1~\ctxdot]}
          {d_2[c_1[`r][\pi_1~\ctxdot]/x][c_2[`r][\pi_1~\ctxdot/x][\pi_2~\ctxdot]]}}
        
        \step{Définition de $c_1'$}
        {`=}
        {\pair{\ip{\Sigma x : X.Y}{`D}}
          {e_1[\pi_1~\ctxdot]}
          {d_2[c_1'[\pi_1~\ctxdot]/x][c_2[`r][\pi_1~\ctxdot/x][\pi_2~\ctxdot]]}}
        
        \step{Définition de $d_2'$}
        {`=}
        {\pair{\ip{\Sigma x : X.Y}{`D}}
          {e_1[\pi_1~\ctxdot]}
          {d_2'[\pi_1~\ctxdot/x][c_2[`r][\pi_1~\ctxdot/x][\pi_2~\ctxdot]]}}

        \step{$x `; c_2[\pi_1~\ctxdot/x]$}
        {`=}
        {\pair{\ip{\Sigma x : X.Y}{`D}}
          {e_1[\pi_1~\ctxdot]}
          {d_2'[c_2[`r][\pi_2~\ctxdot]][\pi_1~\ctxdot/x]}}
        
        \step{Définition de $c_2'$}
        {`=}
        {\pair{\ip{\Sigma x : X.Y}{`D}}
          {e_1[\pi_1~\ctxdot]}
          {d_2'[c_2'[\pi_2~\ctxdot]][\pi_1~\ctxdot/x]}}
        
        \step{Définition de $e_2$}
        {`=}
        {\pair{\ip{\Sigma x : X.Y}{`D}}
          {e_1[\pi_1~\ctxdot]}
          {e_2'[\pi_2~\ctxdot][\pi_1~\ctxdot/x]}}

        \step{$x `; \pi_2~\ctxdot$}
        {=}{\pair{\ip{\Sigma x : X.Y}{`D}}
          {e_1[\pi_1~\ctxdot]}
          {e_2[\pi_1~\ctxdot/x][\pi_2~\ctxdot]}}
        
        \step{Définition de $e$}
        {\eqdef}{e}
      \end{equations}      
    \end{induction}
    
    
    \case{SubProof}\quad
    \begin{prooftree}
      \AXC{$\subimpl{`G}{e}{S}{T}$}
      \UIC{$\subimpl{`G}{c_1 = 
          \elt{\ip{T}{`G}}{\ip{\lambda x :T.P}{`G}}{e}
          {\ex{\ip{P}{`G, x : T}[e/x]}}}
        {S}{\mysubset{x}{T}{P}}$}
      \AXC{$\subimpl{`D}{c_2}{\mysubset{x}{T}{P}}{U}$}
      \noLine\BIC{} 
    \end{prooftree}
    
    Par induction sur la dérivation de $c_2$.
    \begin{induction}
      \case{SubSub} On a une dérivation $\subimpl{`D}{c_2'}{T}{U}$,
      donc par induction on a $\subimpl{`D}{c'}{S}{U}$ avec
      $c' `= c_2' `o e[`r]$.
      
      On a bien $c' = c_2 `o c_1[`r]$:
      \begin{eqnarray*}
        c_2 `o c_1[`r] & `= & c_2'[\eltpit~\ctxdot] `o c_1[`r] \\
        & = & c_2'[\eltpit~\ctxdot] `o (\elt{\ip{T}{`G}}{\ip{\lambda x :T.P}{`G}}{e}
        {\ex{\ip{P}{`G, x : T}[e/x]}})[`r] \\
        & "->"_{\sigma_1} & c_2'[e[`r]] \\
        & `= & c'
      \end{eqnarray*}

      \case{SubProof} Alors on a:
      \begin{prooftree}
        \AXC{$\subimpl{`D}{c_2'}{\mysubset{x}{T}{P}}{U'}$}
        \UIC{$\subimpl{`D}{c_2 = 
            \elt{\ip{U'}{`D}}{\ip{\lambda x : U'.P'}{`D}}{c_2'}
            {\ex{\ip{P'}{`D, x : U'}[c_2'/x]}}}
          {\mysubset{x}{T}{P}}{\mysubset{x}{U'}{P'}}$}
      \end{prooftree}
      
      On peut appliquer l'hypothèse d'induction pour obtenir une
      dérivation de $\subimpl{`D}{d `= c_2' `o c_1[`r]}{S}{U'}$ et par
      application de \irule{SubProof} on obtient une coercion $c'$:

      \begin{eqnarray*}
        c_2 `o c_1[`r] & \eqdef & 
        (\elt{\ip{U'}{`D}}{\ip{\lambda x : U'.P'}{`D}}{c_2'}
        {\ex{\ip{P'}{`D, x : U'}[c_2'/x]}}) `o c_1[`r] \\
        & = &
        \elt{\ip{U'}{`D}}{\ip{\lambda x : U'.P'}{`D}}{c_2'[c_1[`r]]}
        {\ex{\ip{P'}{`D, x : U'}[c_2'[c_1[`r]]/x]}} \\
        & `= & \elt{\ip{U'}{`D}}{\ip{\lambda x : U'.P'}{`D}}{d}
        {\ex{\ip{P'}{`D, x : U'}[d/x]}} \\
        & \eqdef & c'
      \end{eqnarray*}
      
    \end{induction}
    
    \case{SubSub}
    \begin{prooftree}
      \AXC{$\subimpl{`G}{c}{S'}{T}$}
      \UIC{$\subimpl{`G}{d = c[\eltpit~\ctxdot]}{S = \mysubset{x}{S'}{P}}{T}$}
      \AXC{$\subimpl{`D}{e}{T}{U}$}
      \noLine\BIC{$$}
    \end{prooftree}
    
    Par induction il existe une dérivation de $\subimpl{`D}{f `= e `o c[`r]}
    {S'}{U}$. On peut donc dériver:

    \begin{prooftree}
      \AXC{$\subimpl{`D}{f}{S'}{U}$}
      \UIC{$\subimpl{`D}{f[\eltpit~\ctxdot]}{S = \mysubset{x}{S'}{P}}{U}$}
    \end{prooftree}
    
    On a bien $f[\eltpit~\ctxdot] `= (e `o c[`r])[\eltpit~\ctxdot] = e
    `o c[`r][\eltpit~\ctxdot] = e `o c[\eltpit~\ctxdot][`r]~\eqdef~e `o
    d[`r]$.
    
    Dans le cas où \irule{SubSub} est utilisée à droite, la seule règle
    applicable à gauche est \irule{SubProof} et l'on a déjà traité ce cas.
  \end{induction}
\end{proof}

\begin{corrolary}[Transitivité de la coercion]
  \label{coerce-trans}
  Si $\subimpl{`G}{c_1}{S}{T}$ et $\subimpl{`G}{c_2}{T}{U}$ alors il
  existe $c `= c_2 `o c_1$ tel que $\subimpl{`G}{c}{S}{U}$.
\end{corrolary}

On peut maintenant énoncer le lemme de symétrie:

\begin{lemma}[Symétrie de la coercion]
  \label{coerce-sym}
  S'il existe $c$ tel que $\subimpl{`G}{c}{A}{B}$ alors $`E!c^{-1}, 
  \subimpl{`G}{c^{-1}}{B}{A}$ et $c^{-1} `o c `= \ctxdot `= c `o c^{-1}$.
\end{lemma}
\begin{proof}
  On sait que le jugement $\suba$ est symétrique, c'est à dire qu'on a
  l'existence des inverses. On utilise la transitivité pour montrer le
  reste du lemme. Si $\subimpl{`G}{c}{A}{B}$ et
  $\subimpl{`G}{c^{-1}}{B}{A}$ alors il existe des coercions $f$ et
  $f^{-1}$ telles que
  $\subimpl{`G}{f `= c^{-1} `o c}{A}{A}$ et $\subimpl{`G}{f^{-1}
    `= c `o c^{-1}}{B}{B}$. Par réflexivité (lemme \ref{coerce-refl})
  et unicité des coercions, $f `= \ctxdot$ et $f^{-1} `= \ctxdot$.
\end{proof}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "subset-typing"
%%% LaTeX-command: "TEXINPUTS=\"..:style:$TEXINPUTS\" latex"
%%% End: 
