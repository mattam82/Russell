
\begin{lemma}[Unicité de la coercion]
  \label{coercion-unicity}
  Si $`G \typea T, U : s$ alors si $\subimpl{`G}{c}{T}{U}$ et
  $\subimpl{`G}{c'}{T}{U}$ alors $c = c'$.
\end{lemma}

\begin{proof}
  Par induction lexicographique sur la paire de dérivations de $c$ et $c'$.
  Seule la régle \irule{SubHnf} peut s'appliquer n'importe quand. 
  Supposons que la dérivation de $c$ se termine par une application de \irule{SubHnf}.
  Quelque soit la dernière règle appliquée dans la dérivation de $c'$,
  on a $T = \hnf{T}$ et $U = \hnf{U}$. Par induction on a donc $c = c'$.
\end{proof}

On peut donc raisonner comme ceci: si l'on parvient à construire une
dérivation de $\subimpl{`G}{c}{T}{U}$ alors c'est l'unique dérivation
existante.

\begin{lemma}[Coercion et formes normales de tête]
  \label{substi-coercion-hnf}
  Si $`G \typec c : T \suba U$ alors $`G \typec c' : \hnf{T}~\suba
  \hnf{U}$ avec $c \eqbr c'$ est dérivable par une dérivation plus
  petite ou égale.
\end{lemma}

\begin{proof}
  Par idempotence de la mise en forme normale de tête, on a la même
  dérivation dans le cas ou la dernière règle appliquée était
  \irule{SubHnf}, sinon c'est trivial.
\end{proof}

\begin{lemma}[Coercion de termes convertibles]
  \label{subti-eqb-coercion-eqbe-id}
  Si $`G \typea T, U : s$ et $T \eqbr U$ alors il existe $c$, $`G \typec
  c : T \suba U$ avec $c \eqbre \ctxdot$.
\end{lemma}

\begin{proof}
  Par induction sur la forme normale de $T$ notée $\nf{T}$.

  \begin{itemize}
  \item $\nf{T} = \Pi y : A.B$ Alors, $\nf{U} = \Pi y : A'.B'$ avec $A
    \eqbr A'$, $B \eqbr B'$. Par induction, $c_1 \eqbre \ctxdot: A' \sub A$
    et $c_2 \eqbre \ctxdot : B \sub B'$. On a donc:
    \begin{eqnarray*}
      c & = & \lambda x : \ip{A'}{`G}. c_2[\ctxdot~(c_1[x]) \\
      & \eqbre & \lambda x : \ip{A'}{`G}. \ctxdot~x \\
      & \eqbre & \ctxdot
    \end{eqnarray*}
    De façon équivalente pour $\Sigma, \{|\}$.
    
  \item Si $\nf{T}$ n'a pas pour symbole de tête, $\Pi, \Sigma$ ou
    $\{|\}$, alors il est possible que $U$ est pour symbole de tête un
    type sous-ensemble auquel cas le mécanisme est similaire.  Dans tout
    les autres cas, \irule{SubConv} est la seule règle applicable et on
    a $c = \ctxdot$.
  \end{itemize}
\end{proof}

\input{subset-typing-impl-subtyping-subst}

\input{subset-typing-impl-subtyping-trans}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "subset-typing"
%%% LaTeX-command: "TEXINPUTS=\"style:$TEXINPUTS\" latex"
%%% End: 
